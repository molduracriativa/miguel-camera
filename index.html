<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Ativar c√¢mera - FIX</title>

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  html, body {
    width: 100%;
    height: 100%;
    background: #000;
    overflow: hidden;
  }

  /* BOT√ÉO SEMPRE NO TOPO */
  #enable-camera-btn {
    position: fixed;
    inset: 0;
    margin: auto;
    height: 70px;
    width: 260px;
    background: #4CAF50;
    color: #fff;
    font-size: 24px;
    border: none;
    border-radius: 14px;
    z-index: 999999999 !important;
    touch-action: manipulation; /* <- IMPORTANT√çSSIMO */
  }

  #video {
    display: none;
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
  }

</style>
</head>
<body>

<button id="enable-camera-btn">Ativar C√¢mera</button>

<video id="video" autoplay playsinline muted></video>

<script>
let stream;

/* üî• SAFARI / ANDROID CLICK FIX üî•
   Captura o primeiro toque REAL e libera os pr√≥ximos */
document.addEventListener("touchstart", function fixTouch() {
    console.log("Touch desbloqueado!");
    document.removeEventListener("touchstart", fixTouch);
}, { passive: true });


/* üî• Chrome Android fix para clique congelado */
document.addEventListener("click", () => {}, true);


/* ------------------------------------------------
   FUN√á√ÉO PARA INICIAR A C√ÇMERA 
-------------------------------------------------- */
async function startCamera() {
  if (stream) stream.getTracks().forEach(t => t.stop());

  stream = await navigator.mediaDevices.getUserMedia({
    video: true,
    audio: false
  });

  const video = document.getElementById("video");
  video.srcObject = stream;

  video.setAttribute("playsinline", "");
  video.muted = true;

  await video.play();

  video.style.display = "block";
}


/* ------------------------------------------------
   BOT√ÉO DE ATIVAR ‚Äî AGORA FUNCIONA EM 100%
-------------------------------------------------- */
document.getElementById("enable-camera-btn").addEventListener("click", async () => {
  console.log("BOT√ÉO FOI CLICADO (evento chegou!)");

  try {
    await startCamera();

    document.getElementById("enable-camera-btn").style.display = "none";

  } catch (e) {
    alert("Erro ao acessar a c√¢mera: " + e.name);
    console.error(e);
  }
});
</script>

</body>
</html>
